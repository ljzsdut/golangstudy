[TOC]

# **基本数据类型的类型转换**

Go默认是不会进行数据类型的隐士转换的(即不能自动进行数据转换)，需要我们显示指定数据类型转换。

## 1 兄弟类型转换

类型转换的基本语法：`TYPE(var)`，	TYPE表示数据类型，var表示要进行类型转换的变量。例如`int32(a)`

**兄弟类型转换使用细节：**

- `TYPE(var)`这种方式只适合兄弟类型的转换(数字类型之间转换：int8 int32 float之间的转换)，不适合大类型之间转换（比如int32 与string之间的转换）。

- 不是所有数据类型都能转换的，例如字母格式的string类型"abcd"转换为int肯定会失败

- 被转换的是变量存储的数据(即值)，变量本身的数据类型没有发生变化。

- 在(范围)大转小的转换中，比如将int64转换为int8，编译时不会报错，只是转换的结果是按照溢出处理，和我们希望的结果不一样。

- 低精度转换为高精度时是安全的，高精度的值转换为低精度时会丢失精度。例如float32转换为int

## 2 大类型转换－基本数据类型转string类型

方式1：使用fmt.Sprintf("%参数"，表达式)函数， 根据于格式说明符进行格式化并返回其结果字符串。

```go
unc main() {
	var num1 int = 99
	var num2 float32 = 23.456
	var b bool = true
	var char byte = 'h'
	var str1, str2, str3, str4 string

	str1 = fmt.Sprintf("%d", num1)
	str2 = fmt.Sprintf("%f", num2)
	str3 = fmt.Sprintf("%t", b)
	str4 = fmt.Sprintf("%c", char)

	fmt.Println(str1) // 99
	fmt.Println(str2) // 23.455999
	fmt.Println(str3) // true
	fmt.Println(str4) // h
}
```

方式2：使用strconv.FormatXXX()系列函数

使用strconv包中的Format类函数进行转换，详见下文。

## 3 大类型转换－string转基本数据类型

使用strconv包中的Parse类函数进行转换，详见下文。

## 4 strconv包

strconv包提供了布尔型、整型数、浮点数和对应字符串的相互转换，还提供了双引号转义相关的转换。

这个包里提供了很多函数，大概分为几类：

1) 字符串转int：Atoi()

2) int转字符串: Itoa()

3) ParseTYPE类函数将string转换为TYPE类型：ParseBool()、ParseFloat()、ParseInt()、ParseUint()。因为string转其它类型可能会失败，所以这些函数都有第二个返回值表示是否转换成功

4) FormatTYPE类函数将其它类型TYPE转string类型：FormatBool()、FormatFloat()、FormatInt()、FormatUint()

5) AppendTYPE类函数用于将TYPE转换成字符串后append到一个slice中：AppendBool()、AppendFloat()、AppendInt()、AppendUint()

还有其他一些基本用不上的函数，见官方手册：go doc strconv或者https://golang.org/pkg/strconv/。

>当有些类型无法转换时，将报错，返回的错误是strconv包中自行定义的error类型。有两种错误：
>
>var ErrRange = errors.New("value out of range")
>var ErrSyntax = errors.New("invalid syntax")
>
>例如，使用Atoi("a")将"a"转换为int类型，自然是不成功的。如果print输出err信息，将显示：
>
>strconv.Atoi: parsing "a": invalid syntax

### 4.1 string和int的相互转换

- int转换为字符串：Itoa()

```go
println("a" + strconv.Itoa(32))  // a32
```

- string转换为int：Atoi()，2个返回值

由于string可能无法转换为int(比如非形似数字的字符串"abc")，所以这个函数有两个返回值：第一个返回值是转换成int的值，第二个返回值判断是否转换成功。

```go
func main() {
	i, _ := strconv.Atoi("3")
	println(3 + i) // 6

	// Atoi()转换失败
	i, err := strconv.Atoi("a")
	if err != nil {
		println("converted failed")
	}
}
```

### 4.2 ParseTYPE类函数（字符串解析）

​		Parse类函数用于转换字符串为给定类型的值：ParseBool()、ParseFloat()、ParseInt()、ParseUint()。由于字符串转换为其它类型可能会失败，所以这些函数都有两个返回值，第一个返回值保存转换后的值，第二个返回值判断是否转换成功。



### 4.3 FormatTYPE类函数（格式化成字符串）

将给定类型格式化为string类型：FormatBool()、FormatFloat()、FormatInt()、FormatUint()。



### 4.4 AppendTYPE类函数（格式化成slice）

AppendTP类函数用于将TP转换成字符串后append到一个slice中：AppendBool()、AppendFloat()、AppendInt()、AppendUint()。Append类的函数和Format类的函数工作方式类似，只不过是将转换后的结果追加到一个slice中。